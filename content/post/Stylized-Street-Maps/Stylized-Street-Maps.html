---
author: "Max Blasdel"
date: "September 29, 2019"
title: "Streets of Humboldt Bay Area"
---

<script src="/rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<script src="/rmarkdown-libs/jquery/jquery.min.js"></script>
<link href="/rmarkdown-libs/leaflet/leaflet.css" rel="stylesheet" />
<script src="/rmarkdown-libs/leaflet/leaflet.js"></script>
<link href="/rmarkdown-libs/leafletfix/leafletfix.css" rel="stylesheet" />
<script src="/rmarkdown-libs/Proj4Leaflet/proj4-compressed.js"></script>
<script src="/rmarkdown-libs/Proj4Leaflet/proj4leaflet.js"></script>
<link href="/rmarkdown-libs/rstudio_leaflet/rstudio_leaflet.css" rel="stylesheet" />
<script src="/rmarkdown-libs/leaflet-binding/leaflet.js"></script>


<p>The following workflow is inspired by some posts I saw on Reddit visualizing the streets of major cities by their suffixes. I decided to do a version for Humboldt. I came up with my own workflow for creating these stylized maps with R.</p>
<p>Data of the streets of Humboldt County was downloaded from the <a href="https://humboldtgov.org/276/GIS-Data-Download">County Website</a></p>
<div id="load-libraries" class="section level2">
<h2>Load Libraries</h2>
<pre class="r"><code>library(sf) # for spatial manipulation
library(dplyr) # data wrangling
library(ggplot2) # visualization and final graphing
library(mapview) # interactive widget library</code></pre>
<p>Find the shapefiles downloaded and unzipped from above link</p>
<pre class="r"><code>shapes_path &lt;- dir(pattern = &quot;.shp$&quot;, # find shp files
                   full.names = T)</code></pre>
</div>
<div id="load-data" class="section level2">
<h2>Load data</h2>
<pre class="r"><code>roads &lt;-
  read_sf(shapes_path)

# inspect
# head(as.data.frame(roads))</code></pre>
<p>There are lots of extra data fields that are not needed here. We inspect to find the <code>STREETTYPE</code> column. This step wil take some digging with different datasets.</p>
</div>
<div id="prepare-data" class="section level2">
<h2>Prepare Data</h2>
<p>Select only the relevant information for plotting</p>
<pre class="r"><code>roads &lt;-
  roads %&gt;%
  select(STREETTYPE)</code></pre>
<p>Projecting the data into a general lat/long coordinate system.</p>
<pre class="r"><code>roads &lt;-
  st_transform(roads, crs = 4326) # WGS 84</code></pre>
<p>Select a point to center the map around. I played around with this a bit using <a href="https://earth.google.com/web/">Google Earth</a> and chose a point in Arcata Bay. <em>You can change the coordinates to deimal in the settings</em></p>
<pre class="r"><code>Eureka &lt;- 
  data.frame(y = 40.828731, 
            x = -124.116183)

Eureka &lt;-
  st_as_sf(Eureka,
         coords = c(&quot;x&quot;, &quot;y&quot;), 
         crs = 4326) # chose the same coordinate system as above</code></pre>
<p>Create a buffer around the chosen point to clip the road data to. The data should really be in a projected coordinate system but this approach still works. The <code>dist</code> value here is arc degrees which can be hard to conceptualize. Projecting the data to a UTM coordinate system is probably a better approach.</p>
<p>Check the buffer distance. This was an iterative process to get the <code>dist</code> value correct made easier by mapview.</p>
<pre class="r"><code>buf &lt;- st_buffer(Eureka, dist = .08)

  leaflet::leaflet() %&gt;% 
  leaflet::addTiles() %&gt;% 
  leaflet::addPolygons(data = buf)</code></pre>
<p><div id="htmlwidget-1" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addPolygons","args":[[[[{"lng":[-124.036183,-124.03629263722,-124.036621248371,-124.037167932752,-124.037931191941,-124.038908933897,-124.040098478696,-124.04149656588,-124.043099363389,-124.044902478065,-124.046900967697,-124.049089354564,-124.05146164045,-124.054011323083,-124.056731413962,-124.059614457505,-124.062652551491,-124.065837368716,-124.069160179817,-124.072611877199,-124.076183,-124.079863760021,-124.083644068554,-124.087513564036,-124.09146164045,-124.095477476392,-124.099550064735,-124.103668242797,-124.107820722939,-124.111996123501,-124.116183,-124.120369876499,-124.124545277061,-124.128697757203,-124.132815935265,-124.136888523608,-124.14090435955,-124.144852435964,-124.148721931446,-124.152502239979,-124.156183,-124.159754122801,-124.163205820183,-124.166528631284,-124.169713448509,-124.172751542495,-124.175634586038,-124.178354676917,-124.18090435955,-124.183276645436,-124.185465032303,-124.187463521935,-124.189266636611,-124.19086943412,-124.192267521304,-124.193457066103,-124.194434808059,-124.195198067248,-124.195744751629,-124.19607336278,-124.196183,-124.19607336278,-124.195744751629,-124.195198067248,-124.194434808059,-124.193457066103,-124.192267521304,-124.19086943412,-124.189266636611,-124.187463521935,-124.185465032303,-124.183276645436,-124.18090435955,-124.178354676917,-124.175634586038,-124.172751542495,-124.169713448509,-124.166528631284,-124.163205820183,-124.159754122801,-124.156183,-124.152502239979,-124.148721931446,-124.144852435964,-124.14090435955,-124.136888523608,-124.132815935265,-124.128697757203,-124.124545277061,-124.120369876499,-124.116183,-124.111996123501,-124.107820722939,-124.103668242797,-124.099550064735,-124.095477476392,-124.09146164045,-124.087513564036,-124.083644068554,-124.079863760021,-124.076183,-124.072611877199,-124.069160179817,-124.065837368716,-124.062652551491,-124.059614457505,-124.056731413962,-124.054011323083,-124.05146164045,-124.049089354564,-124.046900967697,-124.044902478065,-124.043099363389,-124.04149656588,-124.040098478696,-124.038908933897,-124.037931191941,-124.037167932752,-124.036621248371,-124.03629263722,-124.036183],"lat":[40.828731,40.8245441235006,40.8203687229386,40.8162162427968,40.8120980647346,40.8080254763918,40.80400964045,40.8000615640364,40.7961920685539,40.7924117600208,40.788731,40.7851598771988,40.7817081798166,40.778385368716,40.7752005514913,40.7721624575051,40.7692794139618,40.7665593230834,40.76400964045,40.7616373545644,40.7594489676972,40.7574504780649,40.7556473633886,40.7540445658802,40.7526464786964,40.7514569338969,40.7504791919413,40.7497159327524,40.7491692483705,40.7488406372196,40.748731,40.7488406372196,40.7491692483705,40.7497159327524,40.7504791919413,40.7514569338969,40.7526464786964,40.7540445658802,40.7556473633886,40.7574504780649,40.7594489676972,40.7616373545644,40.76400964045,40.7665593230834,40.7692794139618,40.7721624575051,40.7752005514913,40.778385368716,40.7817081798166,40.7851598771988,40.788731,40.7924117600208,40.7961920685539,40.8000615640364,40.80400964045,40.8080254763918,40.8120980647346,40.8162162427968,40.8203687229386,40.8245441235006,40.828731,40.8329178764994,40.8370932770614,40.8412457572032,40.8453639352654,40.8494365236082,40.85345235955,40.8574004359636,40.8612699314461,40.8650502399792,40.868731,40.8723021228012,40.8757538201834,40.879076631284,40.8822614485087,40.8852995424949,40.8881825860382,40.8909026769166,40.89345235955,40.8958246454356,40.8980130323027,40.9000115219351,40.9018146366114,40.9034174341198,40.9048155213036,40.9060050661031,40.9069828080587,40.9077460672476,40.9082927516295,40.9086213627804,40.908731,40.9086213627804,40.9082927516295,40.9077460672476,40.9069828080587,40.9060050661031,40.9048155213036,40.9034174341198,40.9018146366114,40.9000115219351,40.8980130323027,40.8958246454356,40.89345235955,40.8909026769166,40.8881825860382,40.8852995424949,40.8822614485087,40.879076631284,40.8757538201834,40.8723021228012,40.868731,40.8650502399792,40.8612699314461,40.8574004359636,40.85345235955,40.8494365236082,40.8453639352654,40.8412457572032,40.8370932770614,40.8329178764994,40.828731]}]]],null,null,{"interactive":true,"className":"","stroke":true,"color":"#03F","weight":5,"opacity":0.5,"fill":true,"fillColor":"#03F","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"limits":{"lat":[40.748731,40.908731],"lng":[-124.196183,-124.036183]}},"evals":[],"jsHooks":[]}</script>
<em>There will be some warnings about the coordinate system being in lat/long and the distance being in degrees</em></p>
<p>Create the buffer and crop the roads layer to inside the desired buffer.</p>
<pre class="r"><code>buff &lt;-
  st_buffer(Eureka, dist = .08)

roads &lt;-
  st_intersection(roads, buff) </code></pre>
<p>There are lots of suffixes that are not well represented in the data. To keep the legend a reasonable size I’m selecting only the top seven suffixes.</p>
<pre class="r"><code>top_seven_roads &lt;-
  roads %&gt;%
  as.data.frame() %&gt;% # drop geometry column
  dplyr::count(STREETTYPE) %&gt;%
  arrange(desc(n)) %&gt;% # arrange from most to least
  slice(1:7) %&gt;% # take the top seven
  pull(STREETTYPE)

top_seven_roads</code></pre>
<pre><code>## [1] &quot;ST&quot;  &quot;RD&quot;  &quot;AVE&quot; &quot;DR&quot;  &quot;LN&quot;  NA    &quot;CT&quot;</code></pre>
<div id="set-all-of-the-other-suffixes-to-other" class="section level3">
<h3>Set all of the other suffixes to “Other”</h3>
<p>For this data <code>NA</code> was one of the top eight values from the above operation. Notice that <code>NA</code> is the R value <code>NA</code> while every other value is a character (in quotes). Change <code>NA</code> values to “None”. Everything else will be “Other”.</p>
<pre class="r"><code>roads &lt;-
  roads %&gt;%
    mutate(STREETTYPE = case_when(is.na(STREETTYPE) ~ &quot;Other&quot;,
                                  STREETTYPE %in% top_seven_roads ~ STREETTYPE,
                                  TRUE ~ &quot;Other&quot;))

roads$STREETTYPE %&gt;%
  unique()</code></pre>
<pre><code>## [1] &quot;RD&quot;    &quot;CT&quot;    &quot;ST&quot;    &quot;AVE&quot;   &quot;Other&quot; &quot;LN&quot;    &quot;DR&quot;</code></pre>
</div>
</div>
<div id="prep-data-for-plotting" class="section level2">
<h2>Prep data for plotting</h2>
<p>Create a vector of colors that is assoicated with each road type and reclassify the characters to factors. This allows the legend to be in the desired order.</p>
<p>I decided to check out the <a href="https://github.com/ewenme/ghibli">Studio Ghibli</a> color paletts here for fun.
The ghibli color palettes print with the assinged color in the console, which is fun.</p>
<pre class="r"><code>ghibli::ghibli_palettes$PonyoMedium # going with a relatively varied palette</code></pre>
<pre><code>## &lt;colors&gt;
## #4C413FFF #5A6F80FF #278B9AFF #E75B64FF #DE7862FF #D8AF39FF #E8C4A2FF</code></pre>
<pre class="r"><code>roads$STREETTYPE &lt;- factor(roads$STREETTYPE,
                           levels = c(&quot;RD&quot;,
                                      &quot;CT&quot;,
                                      &quot;AVE&quot;,
                                      &quot;ST&quot;,
                                      &quot;DR&quot;,
                                      &quot;LN&quot;,
                                      &quot;WAY&quot;,
                                      &quot;Other&quot;))</code></pre>
</div>
<div id="plotting" class="section level2">
<h2>Plotting</h2>
<p>Plot out the finished product. I put the most time into this part and there are probably other ways to acheive the same results with different ggplot functions. I’ve added comments to help identify what does what. You may have to change the <code>plot.title</code> depending on the output size of the png.</p>
<pre class="r"><code>ggplot() +
  geom_sf(data = roads,
          aes(colour = STREETTYPE), # color by column value
          show.legend = &quot;point&quot;) + # get legend as circles
  theme_void() + # remove default gray background
  theme(legend.position = &quot;bottom&quot;,
        text = element_text(size = 20)) + # set all text large. Play with this number based on desired img size
  guides(color = guide_legend(nrow = 1, # have legend all on one line
                              override.aes = (list(size = 5)))) + # change size of point symbols in legend
  scale_color_manual(name = &quot;Street Suffix&quot;, # name of legend
                     values = ghibli::ghibli_palettes$PonyoMedium) + # our selected color palette
  ggtitle(&quot;Humboldt Bay Area&quot;) +
  theme(plot.title = element_text(size = 40))</code></pre>
<p><img src="/post/Stylized-Street-Maps/Stylized-Street-Maps_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
</div>
<div id="save-output" class="section level2">
<h2>Save output</h2>
<pre class="r"><code># ggsave(&quot;humStreets.png&quot;,
#        width = 12,
#        height = 18,
#        units = &quot;in&quot;, # specify units of above height and width
#        dpi = 400) # dots per inch</code></pre>
<p>This workflow creates a nice stylized map of street suffixes for Humboldt Bay that can be extended to any area where you have road data.</p>
</div>
